<template>
    <require from="./em-blog-top-menu.css"></require>
    <div ref="topMenuRef" class="ui top fixed inverted blue menu em-blog-top-menu ${isSearchFocus ? 'search-focus' : ''}">
        <div click.delegate="toggleHandler()" class="item tms-toggle">
            <i class="large ${isHide ? 'indent' : 'outdent'} link icon"></i>
        </div>
        <div ui-dropdown-action class="ui dropdown item tms-links">
            <i class="large content icon"></i>
            <div class="menu">
                <div class="header">系统外链</div>
                <a repeat.for="item of sysLinks" href="${item.href}" target="_blank" class="item">${item.title}</a>
            </div>
        </div>
        <div class="item tms-logo">
            <a href="#/"><img ref="logoRef" src="img/tms-x32.png"></a>
        </div>
        <a class="header item" href="#/blog">
            TMS博文
        </a>
        <div class="item tms-create">
            <a modaal="blog-create" href="#modaal-blog-write" title="博文创建 (c)" class="ui primary button">创建</a>
        </div>
        <div id="modaal-blog-write" style="display:none;">
            <em-blog-write></em-blog-write>
        </div>
        <div class="right menu">
            <a ref="newsRef" show.bind="totalNews > 0" class="item icon" click.delegate="newsRefreshHandler()">
                <i class="announcement large link icon"></i>
                <div class="floating ui red circular label" style="top: 0;">${totalNews > 99 ? '99+' : totalNews }</div>
            </a>
            <div class="ui fluid popup bottom left transition hidden">
                <div class="ui selection divided list">
                    <a class="item" repeat.for="item of news" click.delegate="newsHandler(item)" href="${basePath + '#/blog/' + item.bid + (item.cid ? '?cid=' + item.cid : '')}">
                        <i class="wait large icon"></i>
                        <!-- <i class="check circle large outline icon"></i> -->
                        <div class="content">
                          <div class="header">${item.createDate | timeago}</div>
                          <div if.bind="item.cmd == 'At'" class="description">博文【${item.title}】有提及到你，点击可查看！</div>
                          <div if.bind="item.cmd == 'CAt'" class="description">博文【${item.title}】评论有提及到你，点击可查看！</div>
                          <div if.bind="item.cmd == 'CC'" class="description">博文【${item.title}】有新的评论，点击可查看！</div>
                          <div if.bind="item.cmd == 'CU'" class="description">博文【${item.title}】评论有更新，点击可查看！</div>
                          <div if.bind="item.cmd == 'F'" class="description">关注博文【${item.title}】有更新，点击可查看！</div>
                          <div if.bind="item.cmd == 'FCC'" class="description">关注博文【${item.title}】有新评论，点击可查看！</div>
                          <div if.bind="item.cmd == 'FCU'" class="description">关注博文【${item.title}】评论有更新，点击可查看！</div>
                          <div if.bind="item.cmd == 'OU'" class="description">您的博文【${item.title}】有更新，点击可查看！</div>
                        </div>
                    </a>
                </div>
            </div>
            <div class="item">
                <div ref="searchRef" class="ui category search">
                    <div class="ui icon input">
                        <input keyup.trigger="searchKeyupHandler($event)" blur.trigger="searchBlurHandler()" focus.trigger="searchFocusHandler()" class="prompt" type="text" placeholder="搜索...">
                        <i class="search icon"></i>
                    </div>
                    <div class="results"></div>
                </div>
            </div>
            <div ui-dropdown-hover class="ui top right dropdown item tms-login-user ${isActiveSearch ? 'tms-hide' : ''}">
                <em-user-avatar user.bind="loginUser"></em-user-avatar>
                <div class="menu">
                    <div class="header">账户操作</div>
                    <div class="divider"></div>
                    <a class="item" click.delegate="userEditHandler()"><i class="edit icon"></i>修改</a>
                    <a class="item" click.delegate="logoutHandler()"><i class="sign out icon"></i>退出</a>
                </div>
            </div>
        </div>
    </div>
    <em-user-edit user.bind="loginUser" view-model.ref="userEditMd"></em-user-edit>
</template>
