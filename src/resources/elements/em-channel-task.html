<template>
    <require from="./em-channel-task.css"></require>
    <div class="em-channel-task">
        <div ref="containerRef" class="ui equal width internally celled grid">
            <div class="row" style="height: 100%">
                <div class="column" style="height: 100%" repeat.for="col of cols">
                    <h4 class="ui top attached center aligned header">
                  ${col.name}（${col.page.totalElements ? col.page.totalElements : 0}）
                   <div ref="filterRef" class="ui inline dropdown tms-task-filter" title="频道任务过滤" data-col-name="${col.name}" task.bind="initFilterHandler(filterRef, col)">
                        <i class="filter icon"></i>
                        <div class="text"></div>
                        <div class="menu">
                            <div class="ui icon search input">
                                <i class="search icon"></i>
                                <input type="text" placeholder="搜索...">
                            </div>
                            <div class="divider"></div>
                            <div class="scrolling menu">
                                <div repeat.for="item of channel.members" class="item" data-value="${item.username}">
                                    ${item.name ? item.name : item.username}
                                    <i class="red link remove icon" title="清除过滤条件"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    <span class="btn-wrapper">
                        <button click.delegate="refreshHandler(col)" title="刷新同步" class="mini circular ui icon basic button">
                            <i class="refresh icon"></i>
                        </button>
                    </span>
                </h4>
                    <div scrollbar="scrollbar-macosx" class="ui basic segment tms-dd-container s-${col.value}" data-sts="${col.name}">
                        <div repeat.for="item of col.page.content" show.bind="!item._hidden" class="ui green segment tms-dd-task-item" data-id="${item.id}">
                            <em-channel-task-item-header task-item.bind="item" channel.bind="channel"></em-channel-task-item-header>
                            <div ref="mkbodyRef" fancybox class="text markdown-body fr-view" innerhtml.bind="item.content | parseMd:channel | emoji:mkbodyRef"></div>
                            <em-channel-task-item-footer task-item.bind="item" channel.bind="channel" login-user.bind="loginUser" col.bind="col"></em-channel-task-item-footer>
                            <i style="position: absolute; right: 0; bottom: 5px;" if.bind="channel.creator.username == loginUser.username" title="从看板移除该任务" click.delegate="removeHandler(item, col)" class="remove circle outline big red link icon"></i>
                        </div>
                    </div>
                    <div if.bind="col.page && !col.page.last" click.delegate="moreHandler(col)" class="basic ui fluid button ${col.ajax && col.ajax.readyState != 4 ? 'tms-disabled2' : ''}"><i show.bind="col.ajax && col.ajax.readyState != 4" class="spinner loading icon"></i> 加载更多(${col.moreCnt})</div>
                </div>
            </div>
        </div>
    </div>
    <em-channel-chat-task-talk-modal channel.bind="channel" view-model.ref="talkVm"></em-channel-chat-task-talk-modal>
</template>
