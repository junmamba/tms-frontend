<template>
    <require from="./em-blog-content.css"></require>
    <div show.bind="blog" class="em-blog-content">
        <div class="topbar">
            <div class="ui breadcrumb">
                <a class="section">TMS博文</a>
                <div show.bind="blog.space" class="divider"> / </div>
                <a show.bind="blog.space" class="section active">${blog.space.name}</a>
                <span data-tooltip="${blog.privated ? '私有博文' : '公开博文'}" data-position="right center" style="margin-left: 16px;"><i click.delegate="updatePrivatedHandler()" class="link icon ${blog.privated ? 'lock' : 'unlock alternate'}"></i></span>
            </div>
            <div class="actions">
                <a if.bind="isSuper || blog.creator.username == loginUser.username" href="#" class="ui basic mini button" click.delegate="editHandler()">
                    <i class="large icon edit"></i> 编辑
                </a>
                <em-blog-share blog.bind="blog"></em-blog-share>
                <div ui-dropdown-action class="ui top right pointing dropdown basic mini icon button">
                    <i class="large ellipsis horizontal icon"></i>
                    <div class="menu">
                        <div if.bind="isSuper || blog.creator.username == loginUser.username" click.delegate="updateSpaceHandler()" class="item">
                            <i class="exchange icon"></i> 移动
                        </div>
                        <div class="divider"></div>
                        <div if.bind="isSuper || blog.creator.username == loginUser.username" click.delegate="deleteHandler()" class="item" style="color: red;">
                            <i class="trash outline icon"></i> 删除
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="header">
            <h1 class="ui header">${blog.title}
                <div class="sub header">
                    <i class="wait icon"></i> <a class="author" data-value="${blog.creator.username}">${blog.creator.username == loginUser.username ? '自己' : blog.creator.name}</a> 创建于 <span title="${blog.createDate | date}">${blog.createDate | timeago}</span>, <a class="author" data-value="${blog.updater.username}">${blog.updater.username == loginUser.username ? '自己' : blog.updater.name}</a> 最后修改于 <span title="${blog.updateDate | date}">${blog.updateDate | timeago}</span>
                </div>
            </h1>
        </div>
        <div swipebox ref="mkbodyRef" class="markdown-body" innerhtml.bind="blog.content | parseMd | emoji:mkbodyRef"></div>
        <em-blog-comment blog.bind="blog"></em-blog-comment>
    </div>
    <div show.bind="!blog" class="em-blog-content">
        <div class="ui positive icon huge message transition">
            <i class="info circle icon"></i>
            <div class="content">
                <div class="header">
                    欢迎使用TMS博文进行知识的分享总结!
                </div>
                <span>现在就去创建自己的博文吧!</span> <a click.delegate="createHandler()" class="ui mini blue button">创建</a>
            </div>
        </div>
    </div>
    <em-confirm-modal em-confirm-modal.ref="emConfirmModal"></em-confirm-modal>
    <em-blog-space-update view-model.ref="blogSpaceUpdateVm"></em-blog-space-update>
</template>
